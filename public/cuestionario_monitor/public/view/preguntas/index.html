<div class="row">
    <div class="col-lg-12">
      	<div class="card" id="rootwizard" style="background: none;-webkit-box-shadow:none;box-shadow:none;">
        	<div class="card-heading text-center">
            <div class="row">
            <div class="col-lg-1"></div>
            	<div class="col-lg-10" style="background: #fff;border-radius: 10px;border: 1px #cee9ff solid;padding: 0 40px;">
                
                
                    <h2><strong>Registro de preguntas</strong></h2>
                    <div class="form-group" style="margin-bottom:20px;">
                    <label class="control-label" style="float:left;">TIPO DE PREGUNTA</label>
                    <select class="form-control" id="tipo_pregunta" onchange="cambiar_preguntax();">
                        <option style="color:#ccc;" disabled="disabled" value="-1" selected>---Seleccione---</option>
                        <option value="1">Matricial</option>
                        <option value="2">Opción única</option>
                        <option value="3">Pregunta abierta</option>
                    </select>
                    </div>
                    <div id='registro_preg' style="display:none;">
                          <div class="form-group label-floating is-empty">
                            <label class="control-label">TITULO</label>
                            <input type="text" class="form-control" name="titulo" id="titulo">
                          </div>

                          <div class="form-inline" id="matriz_cols">
                            <div class="form-group label-floating is-empty">
                              <label class="control-label">Columna A</label>
                              <input type="text" class="form-control" name="col1" id="col1">
                            </div>
                            <div class="form-group label-floating is-empty">
                              <label class="control-label">Columna B</label>
                              <input type="text" class="form-control" name="col2" id="col2">
                            </div>
                            <div class="form-group label-floating is-empty">
                              <label class="control-label">Columna C</label>
                              <input type="text" class="form-control" name="col3" id="col3">
                            </div>
                            <div class="form-group label-floating is-empty">
                              <label class="control-label">Columna D</label>
                              <input type="text" class="form-control" name="col4" id="col4">
                            </div>
                          </div>

                          <input type="hidden" name="idp" id="idp" value="0"><!-- en caso de edición -->
                        <div id='alternativas'>

                        </div>

                          <span id="add-option" class="input-group-btn">
                                <button title="Agregar alternativa" type="button" class="btn btn-blue btn-fab animate-fab btn-fab-sm" onclick="plus()">
                                  <i class="zmdi zmdi-plus"></i>
                                <div class="ripple-container"></div></button>
                          </span>
                          <div class="row"><center>
                            <div class="col-lg-12">
                              <button type="submit" class="btn btn-primary text-left" id="btnreg" onclick="registrarx(0)">Registrar<div class="ripple-container"></div></button>
                            </div>
                            <div class="col-lg-6">
                              <button href="#" class="btn btn-primary text-left" id="btncan" style="display:none;" onclick="cleanx()">Cancelar<div class="ripple-container"></div></button></div>
                            <div class="col-lg-6">
                              <button type="submit" class="btn btn-warning text-left" id="btngua" style="display:none;" onclick="registrarx(1)">Guardar<div class="ripple-container"></div></button></div></center>
                          </div>
                    </div>
            	</div>
              <div class="col-lg-1"></div>
            </div>           
            <br>
            <div class="row">
              <div class="col-lg-1"></div>
                <div class="col-lg-10" style="background: #fff;border-radius: 10px;border: 1px #cee9ff solid;">                
                  <div class="card-body">
                    <h2><strong>Preguntas registradas</strong></h2>
                      <div class="table-responsive text-left">
                        <table class="table">
                          <thead>
                            <tr>
                              <th>#</th>
                              <th>Pregunta</th>
                              <th class="text-center" style="width:35px;">Editar</th>
                              <th class="text-center" style="width:35px;">Eliminar</th>
                            </tr>
                          </thead>
                          <tbody>
                          <?php $i=1;foreach($data as $d) { ?>
                            <tr>
                              <th scope="row"><?php echo $i ?></th>
                              <td><?php echo $d['titulo']; ?>
<!--                                  <label> TIPO DE PREG: <?php echo $d['tipo']; ?></label>-->
                              </td>
                              
                              <th class="text-center"><a href="#" title="Editar" onclick="editarx(<?php echo $d['id']; ?>, <?php echo $d['tipo']; ?>)"><i class="zmdi zmdi-edit text-primary"></i></a></th>
                              <th class="text-center"><a href="#" title="Eliminar" data-toggle="modal" data-target="#toolabr_modal" onclick="mensaje(<?php echo $d['id'].','.$i?>)"><i class="zmdi zmdi-delete text-danger"></i></a></th>
                            </tr>
                          <?php $i++;} ?>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                 <div class="col-lg-1"></div>
            </div>

        	</div>
      	</div>
    </div>
</div>

<script>
  function cambiar_preguntax(){
    $('#registro_preg').css('display','block');
    var tipo_pre=$('#tipo_pregunta').val();
    
    if(tipo_pre==1){
      $('#matriz_cols').css('display','block');
      $('#add-option').css('display','block');
    }else if(tipo_pre==2){
      $('#matriz_cols').css('display','none');
      $('#add-option').css('display','block');
    }else if(tipo_pre==3){
      $('#matriz_cols').css('display','none');
      $('#add-option').css('display','none');
    }
    //alert(tipo_pre);
    //$('#matriz_cols').css('display','none');
  }
  function plus(){
    var n = $('.alternativa').size();n++;
    a='<div class="row altrow" id="alt'+n+'"><div class="form-group label-floating is-empty col-lg-11"><label class="control-label alternativa">Alternativa '+n+'</label><input type="text" class="form-control altinp" id="alter'+n+'"></div><button onclick="deletex('+n+')" title="eliminar" type="button" class="altbut btn btn-danger btn-fab animate-fab btn-fab-sm col-lg-1" style="top: 20px;"><i class="zmdi zmdi-close"></i><div class="ripple-container"></div></button></div>';
    $( "#alternativas" ).append( a );
  }

  function deletex(n){
    $('#alt'+n).html('');
    $('#alt'+n).removeClass('altrow');
    $('#alt'+n).attr("id","x");
    $( ".alternativa" ).each(function( i ) {
        $(this).html('Alternativa '+(i+1));
    });
    $( ".altrow" ).each(function( i ) {
        $(this).attr("id","alt"+(i+1));
    });
    $( ".altinp" ).each(function( i ) {
        $(this).attr("id","alter"+(i+1));
    });
    $( ".altbut" ).each(function( i ) {
        $(this).attr("onclick","deletex("+(i+1)+")");
    });
  }

  function editarx(n, tipo){
    $('#tipo_pregunta').val(tipo);
    $('#tipo_pregunta').attr('disabled', 'disabled'); 
    $('#registro_preg').css('display','block');
    if(tipo==1){ //Matricial
        $('#matriz_cols').css('display','block');
        $('#idp').val(n);
        $.ajax({
          type: "POST",
          url: '?k=preguntas/pregunta',
          data: {'data':n,'tipo':1},
          success: function(d){
            var a = d.split('-/-');

            $('#titulo').val(a[0]);

            $('#col1').val(a[1]);
            $('#col2').val(a[2]);
            $('#col3').val(a[3]);
            $('#col4').val(a[4]);
            $('#alternativas').html(' ');
            for (var i = 5; i < a.length; i++) {
                plus();
            }
            for (var i = 5; i < a.length; i++) {
                $('#alter'+(i-4)).val(a[i]);
            }

            $('.label-floating').removeClass('is-empty'); 
            $('#btncan').css('display','block');
            $('#btngua').css('display','block');
            $('#btnreg').css('display','none');
            $('#add-option').css('display','block');
          }
        });    
    }else if(tipo==2){ //Opción única
        $('#matriz_cols').css('display','none');
        $('#idp').val(n);
        $.ajax({
          type: "POST",
          url: '?k=preguntas/pregunta',
          data: {'data':n ,'tipo':2},
          success: function(d){
//          console.log(d);
//          return false;
            var a = d.split('-/-');
            $('#titulo').val(a[0]);
            $('#alternativas').html(' ');
            for (var i = 1; i < a.length; i++) {
                plus();
            }
            for (var i = 1; i < a.length; i++) {
                $('#alter'+(i)).val(a[i]);
            }

            $('.label-floating').removeClass('is-empty'); 
            $('#btncan').css('display','block');
            $('#btngua').css('display','block');
            $('#btnreg').css('display','none');
            $('#add-option').css('display','block');
          }
        }); 
    }else if(tipo==3){ //Pregunta abierta
        $('#matriz_cols').css('display','none');
        $('#idp').val(n);
        $.ajax({
          type: "POST",
          url: '?k=preguntas/pregunta',
          data: {'data':n ,'tipo':3},
          success: function(d){
//          console.log(d);
//          return false;
            var a = d.split('-/-');
            $('#titulo').val(a[0]);
            $('.label-floating').removeClass('is-empty'); 
            $('#btncan').css('display','block');
            $('#btngua').css('display','block');
            $('#btnreg').css('display','none');
            $('#add-option').css('display','none');
          }
        }); 
    }
  }
  function cleanx(){
      $('#alternativas').html(' ');
      $('input').val(' ');
      $('.label-floating').addClass('is-empty'); 
      $('#btncan').css('display','none');
      $('#btngua').css('display','none');
      $('#btnreg').css('display','block');
      $('#idp').val(0);
      $('#registro_preg').css('display','none');
      $('#tipo_pregunta').removeAttr('disabled');
  }

  function registrarx(x){ //0: insert, 1: update
    var tipo_pre=$('#tipo_pregunta').val();
    if($('#titulo').val()==''){
        alert('Para registrar una pregunta, debe crear al menos un título.')
    }else{
        if(tipo_pre==1){ //Matricial
          var titulo = $('#titulo').val();
          var col1 = $('#col1').val();
          var col2 = $('#col2').val();
          var col3 = $('#col3').val();
          var col4 = $('#col4').val();
          var a='';
          $( ".altinp" ).each(function( i ) {
             var m = (i==0)?'':'-/-';
             a=a+m+$(this).val();
          });

          var idp = 0;
          if(x==1) {idp=$('#idp').val()}; //es update
          $.ajax({
            type: "POST",
            url: '?k=preguntas/registrar',
            data: {'tipo':tipo_pre,'titulo':titulo,'col1':col1,'col2':col2,'col3':col3,'col4':col4,'alt':a,'idp':idp}, 
            success: function(d){ 
            //alert('Se guardo correctamente');
              window.location.href = "?k=preguntas";
            }
          }); 
        }else if(tipo_pre==2){ //Opción única
          var titulo = $('#titulo').val();
          var a='';
          $( ".altinp" ).each(function( i ) {
             var m = (i==0)?'':'-/-';
             a=a+m+$(this).val();
          });
          var idp = 0;
          if(x==1) {idp=$('#idp').val()}; //es update
          $.ajax({
            type: "POST",
            url: '?k=preguntas/registrar',
            data: {'tipo':tipo_pre,'titulo':titulo,'alt':a,'idp':idp}, 
            success: function(d){ 
              window.location.href = "?k=preguntas";
            }
          });
        }else if(tipo_pre==3){ //Pregunta abierta
          var titulo = $('#titulo').val();
          var idp = 0;
          if(x==1) {idp=$('#idp').val()}; //es update
          $.ajax({
            type: "POST",
            url: '?k=preguntas/registrar',
            data: {'tipo':tipo_pre,'titulo':titulo,'idp':idp}, 
            success: function(d){ 
              window.location.href = "?k=preguntas";
            }
          });
        }
    }
  }

  function eliminarx(n){
      $.ajax({
      type: "POST",
      url: '?k=preguntas/eliminar',
      data: {'data':n},
      success: function(d){
        window.location.href = "?k=preguntas";
      }
    });  
  }
      
</script>